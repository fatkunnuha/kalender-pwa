<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Kalender Jawa & Nasional</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2563eb">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">
<link rel="apple-touch-icon" href="icon-192.png">

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      height: 100%;
    }
  </style>
</head>

<body class="h-screen w-screen overflow-hidden bg-gray-100">

<!-- WRAPPER FULLSCREEN -->
<div class="h-full w-full flex flex-col">

  <!-- HEADER -->
  <header class="flex items-center justify-between px-4 py-3 bg-white shadow shrink-0">
    <button onclick="prevMonth()" class="px-3 py-1 bg-gray-200 rounded">◀</button>

    <div class="text-center">
      <div class="text-lg font-bold" id="bulanTahun"></div>
      <div class="text-xs text-gray-500">Kalender Jawa & Nasional</div>
    </div>

    <button onclick="nextMonth()" class="px-3 py-1 bg-gray-200 rounded">▶</button>
  </header>

  <!-- LEGEND -->
  <section class="px-4 py-2 bg-white border-b shrink-0">
    <div class="flex flex-wrap gap-2 text-xs" id="legendLabel"></div>
  </section>

  <!-- HEADER HARI -->
  <section class="grid grid-cols-7 text-center text-sm font-semibold bg-gray-200 shrink-0">
    <div>Minggu</div><div>Senin</div><div>Selasa</div>
    <div>Rabu</div><div>Kamis</div><div>Jumat</div><div>Sabtu</div>
  </section>

  <!-- GRID KALENDER (SCROLLABLE) -->
  <main id="kalender"
    class="flex-1 grid grid-cols-7 gap-px bg-gray-300 overflow-auto">
  </main>

</div>

<!-- MODAL -->
<div id="modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-xl p-5 w-full max-w-md space-y-3">
    <h2 id="modalTitle" class="font-semibold text-lg">Tambah Agenda</h2>

    <input id="agendaId" type="hidden">
    <input id="agendaTanggal" type="date" class="w-full border rounded p-2">
    <input id="agendaJudul" type="text" placeholder="Judul agenda" class="w-full border rounded p-2">
    <input id="agendaWaktu" type="time" class="w-full border rounded p-2">

    <div class="flex gap-2">
      <input id="agendaLabel" type="text" placeholder="Label"
        class="flex-1 border rounded p-2">
      <input id="agendaWarna" type="color" value="#2563eb" class="w-16 h-10">
    </div>

    <div class="flex gap-2 pt-2">
      <button onclick="simpanAgenda()" class="flex-1 bg-blue-600 text-white py-2 rounded">
        Simpan
      </button>
      <button onclick="tutupModal()" class="flex-1 bg-gray-300 py-2 rounded">
        Batal
      </button>
    </div>

    <button id="hapusBtn"
      onclick="hapusAgenda()"
      class="w-full bg-red-600 text-white py-2 rounded hidden">
      Hapus Agenda
    </button>
  </div>
</div>

<script>
/* ===== PWA ===== */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}

/* ===== KALENDER JAWA ===== */
const pasaran = ["Legi","Pahing","Pon","Wage","Kliwon"];
const refDate = new Date("1970-01-01");
const getPasaran = d =>
  pasaran[(Math.floor((d - refDate) / 86400000) % 5 + 5) % 5];

/* ===== STORAGE ===== */
let agendas = JSON.parse(localStorage.getItem("agendas")) || [];
const saveStorage = () =>
  localStorage.setItem("agendas", JSON.stringify(agendas));

/* ===== STATE ===== */
let currentDate = new Date();

/* ===== RENDER ===== */
function renderLegend() {
  legendLabel.innerHTML = "";
  const map = {};
  agendas.forEach(a => a.label && (map[a.label] = a.warna));

  if (!Object.keys(map).length) {
    legendLabel.innerHTML = `<span class="text-gray-500">Tidak ada label</span>`;
    return;
  }

  Object.entries(map).forEach(([l,w]) => {
    legendLabel.innerHTML += `
      <span class="flex items-center gap-1 border px-2 py-1 rounded">
        <span class="w-3 h-3 rounded" style="background:${w}"></span>${l}
      </span>`;
  });
}

function renderCalendar() {
  kalender.innerHTML = "";
  renderLegend();

  const y = currentDate.getFullYear();
  const m = currentDate.getMonth();

  bulanTahun.innerText =
    currentDate.toLocaleDateString("id-ID",{month:"long",year:"numeric"});

  const first = new Date(y,m,1).getDay();
  const days = new Date(y,m+1,0).getDate();

  for (let i=0;i<first;i++) {
    kalender.appendChild(document.createElement("div"));
  }

  for (let d=1; d<=days; d++) {
    const dateStr = `${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const cell = document.createElement("div");
    
const today = new Date();
const isToday =
  today.getFullYear() === y &&
  today.getMonth() === m &&
  today.getDate() === d;

cell.className = `
  p-1 text-xs flex flex-col gap-1 cursor-pointer
  ${isToday ? "bg-gray-200" : "bg-white"}
`;
    cell.innerHTML = `
      <div class="font-semibold">${d}</div>
      <div class="text-[10px] text-gray-500">${getPasaran(new Date(dateStr))}</div>
    `;

    agendas.filter(a=>a.tanggal===dateStr).forEach(a=>{
      const ev=document.createElement("div");
      ev.className="rounded px-1 truncate";
      ev.style.background=a.warna;
      ev.style.color="#fff";
      ev.innerText=`${a.waktu} ${a.judul}`;
      ev.onclick=e=>{
        e.stopPropagation();
        bukaModalEdit(a.id);
      };
      cell.appendChild(ev);
    });

    cell.onclick=()=>bukaModalTambah(dateStr);
    kalender.appendChild(cell);
  }
}

function prevMonth(){ currentDate.setMonth(currentDate.getMonth()-1); renderCalendar(); }
function nextMonth(){ currentDate.setMonth(currentDate.getMonth()+1); renderCalendar(); }

/* ===== MODAL ===== */
function bukaModalTambah(t){
  modal.classList.remove("hidden"); modal.classList.add("flex");
  modalTitle.innerText="Tambah Agenda"; hapusBtn.classList.add("hidden");
  agendaId.value=""; agendaTanggal.value=t;
  agendaJudul.value=""; agendaWaktu.value="";
  agendaLabel.value=""; agendaWarna.value="#2563eb";
}
function bukaModalEdit(id){
  const a=agendas.find(x=>x.id===id);
  modal.classList.remove("hidden"); modal.classList.add("flex");
  modalTitle.innerText="Edit Agenda"; hapusBtn.classList.remove("hidden");
  agendaId.value=a.id; agendaTanggal.value=a.tanggal;
  agendaJudul.value=a.judul; agendaWaktu.value=a.waktu;
  agendaLabel.value=a.label; agendaWarna.value=a.warna;
}
function tutupModal(){ modal.classList.add("hidden"); modal.classList.remove("flex"); }

/* ===== CRUD ===== */
function simpanAgenda(){
  const data={
    id:agendaId.value||Date.now().toString(),
    tanggal:agendaTanggal.value,
    judul:agendaJudul.value,
    waktu:agendaWaktu.value,
    label:agendaLabel.value,
    warna:agendaWarna.value
  };
  if(!data.tanggal||!data.judul||!data.waktu){alert("Lengkapi agenda");return;}
  agendas=agendaId.value?agendas.map(a=>a.id===data.id?data:a):[...agendas,data];
  saveStorage(); tutupModal(); renderCalendar();
}
function hapusAgenda(){
  if(!confirm("Hapus agenda?"))return;
  agendas=agendas.filter(a=>a.id!==agendaId.value);
  saveStorage(); tutupModal(); renderCalendar();
}

/* INIT */
renderCalendar();
</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>

